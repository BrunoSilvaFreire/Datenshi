using Datenshi.Scripts.Entities;
using DG.Tweening;
using UnityEngine;
using UnityEngine.UI;

namespace Datenshi.Scripts.Misc {
    public class InvulnerabilityTracker : MonoBehaviour {
        public LivingEntity Entity;
        public float Duration;
        private bool lastFrame;
        public float ScaleOut = 1.2F;
        public Image Outline;

        private void Update() {
            var now = Entity.IsInvulnerable;
            if (lastFrame && !now) {
                Outline.DOKill();
                Outline.transform.DOKill();
                Outline.DOFade(0, Duration);
                var originalDelta = Outline.rectTransform.sizeDelta;
                var delta = originalDelta + new Vector2(ScaleOut, ScaleOut);
                Outline.rectTransform.DOSizeDelta(delta, Duration).OnComplete(() => {
                    Outline.color = Color.clear;
                    Outline.rectTransform.sizeDelta = originalDelta;
                });
            }

            if (now) {
                Outline.color = Color.white;
            }

            lastFrame = now;
        }
    }
}